

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Billiards &#8212; PHYS 4480-7680 Computational Physics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Billiards';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="LAB – Interacting Hard Spheres" href="blankLAB%20Interacting%20Hard%20Spheres.html" />
    <link rel="prev" title="Exploring Chaos with our Duffing Simulator" href="More%20Duffing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="PHYS 4480-7680 Computational Physics - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="PHYS 4480-7680 Computational Physics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Physics 4480 / 7680 / Astronomy 7690
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook%20Workflow.html">Notebook Workflow</a></li>

<li class="toctree-l1"><a class="reference internal" href="Logistics.html">Logistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installing Julia</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quadratures -- Period of a Pendulum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Period%20of%20a%20pendulum.html">Period of a Pendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Period%20of%20a%20Pendulum.html">Lab – Period of a Pendulum</a></li>




<li class="toctree-l1"><a class="reference internal" href="Integration%20Followup.html">Integration Follow-up</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Solving Ordinary Differential Equations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Pendulum%20dynamics.html">Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Projectile%20Motion.html">LAB – Projectile Motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="Automatic%20Differentiation.html">Automatic Differentiation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Classical Mechanics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Symplectic%20Integrators.html">Symmetry Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Chaos.html">LAB – Chaos</a></li>
<li class="toctree-l1"><a class="reference internal" href="Duffing%20Oscillator%20Followup.html">Followup on Duffing Oscillator</a></li>
<li class="toctree-l1"><a class="reference internal" href="Animating%20a%20Pendulum.html">Interactive Animation of Pendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Animating%20the%20Duffing%20Oscillator.html">Lab – Animating the Duffing Oscillator</a></li>
<li class="toctree-l1"><a class="reference internal" href="More%20Duffing.html">Exploring Chaos with our Duffing Simulator</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dynamical Systems without differential equations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Billiards</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Interacting%20Hard%20Spheres.html">LAB – Interacting Hard Spheres</a></li>
<li class="toctree-l1"><a class="reference internal" href="ktheory.html">Kinetic Theory of Gases</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Stochastic Methods</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="sampling.html">Stochastic Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="monte%20carlo%20integration.html">Stochastic approaches to integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metropolis%20Ising%20Model.html">2D Ising Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Correlation%20Times.html">Correlation times</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cluster%20Algorithms.html">Cluster Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Wolff.html">Lab – Wolff Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="Phases%20and%20Phase%20Transitions.html">Phases and Phase Transitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Binder.html">Binder Cumulants and the Scaling Hypothesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Renormalization.html">The Renormalization group</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Billiards.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Billiards</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#class-hierarchies-and-abstract-types">Class Hierarchies and abstract types</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#billiard-class">Billiard Class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ball-class">Ball Class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wall-class">Wall Class</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-roundoff">Dealing with Roundoff</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#circular-walls">Circular Walls</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deciding-which-wall-to-collide-off-of">Deciding which wall to collide off of</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-velocity-after-collision">Setting Velocity after collision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-loop">Main loop</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#poincare-sections">Poincare sections</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#animation">Animation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#circular-billiard">Circular Billiard</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sinai-billiards">Sinai Billiards</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitive-dependence-on-initial-condidtions">Sensitive dependence on initial condidtions</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="billiards">
<h1>Billiards<a class="headerlink" href="#billiards" title="Permalink to this heading">#</a></h1>
<p>It is important in physics to work smart instead of hard.  Previously we used a differential equation solver to study chaos.  Here is a simpler setting to explore the same phenomena: Billiards.  A billiard is typically a two dimensional arena, in which a point particle elastically bounces off of the walls.  It turns out that there are arena shapes for which the behavior is chaotic, and others for which it is regular.</p>
<p>The advantage of working with Billiards is that the particle moves at constant velocity between collisions with the walls.  It introduces a new concept in simulations:  Event driven simulation.  We do away with the ODE solver – and analytically calculate the ball’s trajectory between bounces (events).  The simulation them amounts to simply enumerating the list of events.</p>
<p>To see how this works, suppose a ball is at poition <code class="docutils literal notranslate"><span class="pre">(x,y)</span></code> with velocity <code class="docutils literal notranslate"><span class="pre">(vx,vy)</span></code>.  We want to find out where it will hit a horizontal wall at <span class="math notranslate nohighlight">\(y=h\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Plots</span><span class="p">,</span><span class="n">Logging</span><span class="p">,</span><span class="n">ProgressMeter</span><span class="p">,</span><span class="n">LinearAlgebra</span>
<span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="n">vx</span><span class="o">=-</span><span class="mf">0.8</span><span class="p">;</span><span class="n">vy</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="n">h</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
<span class="n">scatter</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;current location&quot;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="n">h</span><span class="p">,</span><span class="n">h</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;wall&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">vx</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">vy</span><span class="p">],</span><span class="n">arrow</span><span class="o">=</span><span class="nb">true</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;velocity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="data:image/png;base64,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" /></div></div>
</div>
<p>The ball will hit the wall at time <span class="math notranslate nohighlight">\(t=(h-y)/v_y\)</span>.  at the collision point, it will be at position <span class="math notranslate nohighlight">\((x^\prime,y^\prime)=(x+ v_x t,h)\)</span>.  At the wall the <span class="math notranslate nohighlight">\(y\)</span> velocity flips, but <span class="math notranslate nohighlight">\(v_x\)</span> remains the same: <span class="math notranslate nohighlight">\((v_x^\prime,v_y^\prime)=(v_x,-v_y)\)</span>.</p>
<p>Suppose we have a rectangular billiard.  What we will do is simply calcuate the time at which the particle will hit each of the four walls.  We choose the earliest positive time, and get the collision conditions from that wall.  We set <span class="math notranslate nohighlight">\(x,y,v_x,v_y\)</span> accordingly, and repeat.  We end up with a discrete map.</p>
<p>As you see, we do not discretize time in any way.  Thus this strategy is also referred to as a “continuous time simulation”.</p>
<p>It is convenient to make some data structures, and dive into a bit more computer science.</p>
<section id="class-hierarchies-and-abstract-types">
<h2>Class Hierarchies and abstract types<a class="headerlink" href="#class-hierarchies-and-abstract-types" title="Permalink to this heading">#</a></h2>
<section id="billiard-class">
<h3>Billiard Class<a class="headerlink" href="#billiard-class" title="Permalink to this heading">#</a></h3>
<p>Lets create a class which corresponds to a billiards.  It should know about where the walls are, and where the ball is.  For plotting it is also for it to know about its “bounding box” – which is the coordinates of a rectangle which encloses the entire shape.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">Billiard</span>
<span class="w">    </span><span class="n">walls</span><span class="w"> </span><span class="o">::</span><span class="kt">Array</span><span class="p">{</span><span class="kt">Wall</span><span class="p">}</span>
<span class="w">    </span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span>
<span class="w">    </span><span class="n">boundingbox</span><span class="w"> </span><span class="c"># x1,y1,x2,y2 = corners of a rectangle</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">UndefVarError</span>: `Wall` not defined

<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>Here we have stored the wall information as an <code class="docutils literal notranslate"><span class="pre">Array</span></code> of <code class="docutils literal notranslate"><span class="pre">Wall</span></code> objects – which we have not yet defined.  Similarly, the information about the ball is in a <code class="docutils literal notranslate"><span class="pre">Ball</span></code> object.  Of course, we get an error message because we have not yet devied these types.</p>
<p>This restriction of attributes to certain types is useful, as it prevents unexpected behavior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">intcontainer</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">::</span><span class="kt">Int64</span>
<span class="k">end</span>

<span class="k">struct</span> <span class="kt">floatcontainer</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">::</span><span class="kt">Float64</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span><span class="n">intcontainer</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">i</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">j</span><span class="o">=</span><span class="n">floatcontainer</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">j</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">intcontainer</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The other possible advantage of declaring your types inside your container objects is that it gives the compiler some extra information about how to work with them.  This can lead to faster code.  We will look more into that later in the course.  Right now the main reason for type declarations is to make the programming easier.</p>
</section>
<section id="ball-class">
<h3>Ball Class<a class="headerlink" href="#ball-class" title="Permalink to this heading">#</a></h3>
<p>Lets now make our <code class="docutils literal notranslate"><span class="pre">Ball</span></code> object.  It needs to store the position, velocity, and time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">Ball</span>
<span class="w">    </span><span class="n">x</span>
<span class="w">    </span><span class="n">y</span>
<span class="w">    </span><span class="n">vx</span>
<span class="w">    </span><span class="n">vy</span>
<span class="w">    </span><span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>(Again – we could define the types of these quantities.)</p>
<p>We will also define some <em>interfaces</em>.  These are ways to get interact with the ball object without having to mess with how we implemented the internal structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">set_xvt!</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">xy</span><span class="p">,</span><span class="n">vxy</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">ball</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">xy</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span><span class="n">ball</span><span class="o">.</span><span class="n">vy</span><span class="o">=</span><span class="n">vxy</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">t</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ball</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">set_r!</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ball</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">set_r!</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">ball</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">r</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ball</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">set_v!</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span><span class="n">ball</span><span class="o">.</span><span class="n">vy</span><span class="o">=</span><span class="n">v</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ball</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">set_v!</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">)</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">vx</span><span class="o">=</span><span class="n">vx</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">vy</span><span class="o">=</span><span class="n">vy</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ball</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">set_t!</span><span class="p">(</span><span class="n">ball</span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">ball</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">t</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ball</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">get_r</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">ball</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">ball</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">get_v</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">ball</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span><span class="n">ball</span><span class="o">.</span><span class="n">vy</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">get_t</span><span class="p">(</span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ball</span><span class="o">.</span><span class="n">t</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>These interfaces are not necessary, but they can be nice.  In particular, they allow a separation between how one manipulates the data, and how it is stored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b1</span><span class="o">=</span><span class="n">Ball</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">get_r</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">set_r!</span><span class="p">(</span><span class="n">b1</span><span class="p">,(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Lets add another thing to our <code class="docutils literal notranslate"><span class="pre">Ball</span></code> object – lets make its printout a little more transparent</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">io</span><span class="o">::</span><span class="kt">IO</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span><span class="o">=</span><span class="n">print</span><span class="p">(</span><span class="n">io</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;Ball &lt;&lt; r=&quot;</span><span class="o">*</span><span class="n">repr</span><span class="p">((</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">))</span><span class="o">*</span>
<span class="w">    </span><span class="s">&quot; v=&quot;</span><span class="o">*</span><span class="n">repr</span><span class="p">((</span><span class="n">b</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">vy</span><span class="p">))</span><span class="o">*</span>
<span class="w">    </span><span class="s">&quot; t=&quot;</span><span class="o">*</span><span class="n">repr</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="s">&quot; &gt;&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">set_t!</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A final thing is I like to add some alternative constructors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Ball</span><span class="p">(;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">=</span><span class="n">Ball</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="c"># keyword constructor</span>
<span class="k">function</span><span class="w"> </span><span class="n">Ball</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="c"># constructor using containers</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">r</span>
<span class="w">    </span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="o">=</span><span class="n">v</span>
<span class="w">    </span><span class="n">Ball</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">Ball</span><span class="p">(;</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">=</span><span class="n">Ball</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="c"># keyword constructor using containers</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="wall-class">
<h3>Wall Class<a class="headerlink" href="#wall-class" title="Permalink to this heading">#</a></h3>
<p>Now lets make our <code class="docutils literal notranslate"><span class="pre">Wall</span></code> object.  Here we have a problem.  The description of a horizontal wall is going to be different from a vertical wall.  We may also want to create a slanted wall, or even a curved wall.  Each of these will need different storage requirements.</p>
<p>The solution is to use a heirarchy of classes.  We will make a generic <code class="docutils literal notranslate"><span class="pre">Wall</span></code> class, and then make subclasses.  The generic superclass <code class="docutils literal notranslate"><span class="pre">Wall</span></code> will never actually be instantiated.  It will be what is known as an <em>Abstract Class</em> or <em>Abstract Type</em>.  It is just a label which is used to organize other types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">abstract</span><span class="w"> </span><span class="k">type</span> <span class="kt">Wall</span><span class="w"> </span><span class="k">end</span>

<span class="k">struct</span> <span class="kt">Hwall</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Wall</span>
<span class="w">    </span><span class="n">y</span>
<span class="k">end</span>

<span class="k">struct</span> <span class="kt">Vwall</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">Wall</span>
<span class="w">    </span><span class="n">x</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>One thing we might want to do with a wall is answer the question:  Given the ball’s current postion and velocity, when will it hit the wall?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">impact_time</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Hwall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="o">.</span><span class="n">vy</span><span class="o">+</span><span class="n">b</span><span class="o">.</span><span class="n">t</span>
<span class="n">impact_time</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Vwall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="o">.</span><span class="n">vx</span><span class="o">+</span><span class="n">b</span><span class="o">.</span><span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<p>I am bad at remembering the order in which I need to give arguments, so lets overload another signature:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">impact_time</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">w</span><span class="o">::</span><span class="kt">Wall</span><span class="p">)</span><span class="o">=</span><span class="n">impact_time</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It may also be useful to know the distance to the wall.  We will used a signed distance, which also tells us which side of the wall we are on</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">distance</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Hwall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">distance</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Vwall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

<span class="n">distance</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">w</span><span class="o">::</span><span class="kt">Wall</span><span class="p">)</span><span class="o">=</span><span class="n">distance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Another thing you want to know is, where will it hit?</p>
<p>At this point we can take advantage of the class heirarchy, and define one function (aka method) that works for all walls.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">impact_location</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Wall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">vy</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">impact_time</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Because of how we structured things, we do not need separate <code class="docutils literal notranslate"><span class="pre">impact_location</span></code> methods for <code class="docutils literal notranslate"><span class="pre">Hwall</span></code>’s and <code class="docutils literal notranslate"><span class="pre">Vwall</span></code>’s.  This greatly simplifies our code.  It also means when we are debugging or refactoring we only need to make changes in one place</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@show</span><span class="w"> </span><span class="n">b2</span><span class="o">=</span><span class="n">Ball</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">impact_location</span><span class="p">(</span><span class="n">Hwall</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span><span class="n">b2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As I said, both <code class="docutils literal notranslate"><span class="pre">Hwall</span></code> and <code class="docutils literal notranslate"><span class="pre">Vwall</span></code> now can work with <code class="docutils literal notranslate"><span class="pre">impact_location</span></code>.  This structure is sometimes referred to as <em>inheritance</em>.  The subclasses inherit properties from the superclass.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">impact_location</span><span class="p">(</span><span class="n">Vwall</span><span class="p">(</span><span class="mf">4.</span><span class="p">),</span><span class="n">b2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="dealing-with-roundoff">
<h4>Dealing with Roundoff<a class="headerlink" href="#dealing-with-roundoff" title="Permalink to this heading">#</a></h4>
<p>Our <code class="docutils literal notranslate"><span class="pre">impact_location</span></code> function has a problem.  In exact arithmetic it will put the ball exactly on the wall.  Unfortunately, due to machine precision it will typically be a bit off.  We want to make sure the ball stays in the billiard.  If roundoff puts the ball outside the billiard it can escape.</p>
<p>We will deal with this in the future – but it is good to keep in mind that it will be an issue at some point.</p>
</section>
</section>
<section id="circular-walls">
<h3>Circular Walls<a class="headerlink" href="#circular-walls" title="Permalink to this heading">#</a></h3>
<p>We could then add another wall type.  Say a circle at the origin of radius <span class="math notranslate nohighlight">\(r\)</span>.  To find the impact time we first define the initial time as <span class="math notranslate nohighlight">\(t_0=\)</span> <code class="docutils literal notranslate"><span class="pre">b.t</span></code>, and the initial <span class="math notranslate nohighlight">\(x_0=\)</span> <code class="docutils literal notranslate"><span class="pre">b.x</span></code>, and so on.  We would then have <span class="math notranslate nohighlight">\(x(t)=x_0+(t-t_0) v_x\)</span> and <span class="math notranslate nohighlight">\(y(t)=y_0+(t-t_0) v_y\)</span>.  We then solve <span class="math notranslate nohighlight">\(x^2+y^2=r^2.\)</span>  This gives us a quadratic equation for <span class="math notranslate nohighlight">\(\delta t=t-t_0\)</span>.</p>
<div class="amsmath math notranslate nohighlight" id="equation-a1ca88ea-b26d-48ff-a54e-f9880ad80344">
<span class="eqno">(92)<a class="headerlink" href="#equation-a1ca88ea-b26d-48ff-a54e-f9880ad80344" title="Permalink to this equation">#</a></span>\[\begin{align}
r^2&amp;= x_0^2+y_0^2+ 2\delta t (v_x x_0+ v_y y_0) + \delta t^2 (v_x^2+v_y^2)
\end{align}\]</div>
<p>which gives</p>
<div class="amsmath math notranslate nohighlight" id="equation-5d4ee671-32f8-410e-b459-08238b305633">
<span class="eqno">(93)<a class="headerlink" href="#equation-5d4ee671-32f8-410e-b459-08238b305633" title="Permalink to this equation">#</a></span>\[\begin{align}
\delta t&amp;= \frac{-\vec{v}\cdot \vec{r}_0\pm\sqrt{(\vec{v}\cdot \vec{r}_0)^2-(|r_0|^2-r^2)|v|^2}}{|v|^2}.
\end{align}\]</div>
<p>There are then a number of cases:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|r_0|&lt;r\)</span> – we are inside the circle.  There will always be two solutions, one at positive <span class="math notranslate nohighlight">\(\delta t\)</span>, and one at negative <span class="math notranslate nohighlight">\(\delta t\)</span>.  We want the one with positive <span class="math notranslate nohighlight">\(\delta t\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(|r_0|&gt;r\)</span> and <span class="math notranslate nohighlight">\((\vec{v}\cdot \vec{r}_0)^2&lt;4(|r_0|^2-r^2)|v|^2\)</span>.  We are outside of the circle, but moving on a trajectory which never impacts the circle – the impact time should be infinite</p></li>
<li><p><span class="math notranslate nohighlight">\(|r_0|&gt;r\)</span> and <span class="math notranslate nohighlight">\((\vec{v}\cdot \vec{r}_0)^2&gt;4(|r_0|^2-r^2)|v|^2\)</span>.  We are outside of the circle, and the trajectory intersects the circle twice.</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(\vec{v}\cdot \vec{r}_0&gt;0\)</span> the impact times are both negative:  we can simply set the time to infinity</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\vec{v}\cdot \vec{r}_0&gt;0\)</span> the impact times are both negative: we want the smaller one</p></li>
</ul>
</li>
</ul>
<p>The multiple cases are somewhat tedious.  There is a simpler approach though:</p>
<ol class="arabic simple">
<li><p>First calculate the discriminant <span class="math notranslate nohighlight">\(d=(\vec{v}\cdot\vec r_0)^2-(|r_0|^2-r^2)|v|^2\)</span></p>
<ul class="simple">
<li><p>if the discriminant is negative, the ball is never going to hit the object, so <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">Inf</span></code></p></li>
</ul>
</li>
<li><p>Next calculate <span class="math notranslate nohighlight">\(\delta t_+\)</span> and <span class="math notranslate nohighlight">\(\delta t_-\)</span>.</p>
<ul class="simple">
<li><p>if they are both negative, return <code class="docutils literal notranslate"><span class="pre">Inf</span></code>.  Otherwise return the smallest postive time</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># load in package which gives us dot product x⋅y</span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#?dot</span>
</pre></div>
</div>
</div>
</div>
<p>You can type the “dot” in <span class="math notranslate nohighlight">\(x\cdot y\)</span> by typin <code class="docutils literal notranslate"><span class="pre">\cdot</span></code> and then hitting the tab key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">⋅</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">Cwall</span><span class="w"> </span><span class="o">&lt;:</span><span class="kt">Wall</span>
<span class="w">    </span><span class="n">r</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">distance</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Cwall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="o">=</span><span class="n">norm</span><span class="p">(</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">w</span><span class="o">.</span><span class="n">r</span><span class="o">-</span><span class="n">r</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">impact_time</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Cwall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Unpack variables from inputs</span>
<span class="w">    </span><span class="n">t0</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">t</span>
<span class="w">    </span><span class="n">r0</span><span class="o">=</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">v</span><span class="o">=</span><span class="n">get_v</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">r</span>
<span class="w">    </span><span class="c"># Call function which uses those inputs to calculate impact time</span>
<span class="w">    </span><span class="n">t0</span><span class="o">+</span><span class="n">circ_time</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">circ_time</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Calculate the various terms in our expression</span>
<span class="w">    </span><span class="n">r0dotv</span><span class="o">=</span><span class="n">r0⋅v</span>
<span class="w">    </span><span class="n">vsq</span><span class="o">=</span><span class="n">v⋅v</span>
<span class="w">    </span><span class="n">r0sq</span><span class="o">=</span><span class="n">r0⋅r0</span>
<span class="w">    </span><span class="n">discriminant</span><span class="o">=</span><span class="n">r0dotv</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="n">r0sq</span><span class="p">)</span><span class="o">*</span><span class="n">vsq</span><span class="w">  </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">discriminant</span><span class="o">&lt;</span><span class="mi">0</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Inf</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">times</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="n">r0dotv</span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discriminant</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">vsq</span><span class="p">),(</span><span class="o">-</span><span class="n">r0dotv</span><span class="o">+</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discriminant</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">vsq</span><span class="p">)]</span>
<span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">minmax</span><span class="p">(</span><span class="n">times</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">t2</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="c"># both times are negative</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Inf</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">t1</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="c"># both times are positive</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t1</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="c"># t1&lt;0 and t2&gt;0</span>
<span class="k">end</span>

<span class="s">&quot;&quot;&quot;</span>
<span class="s">This is the tedious way to calculate the collision time with a circle</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">circ_time_tedious</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Calculate the various terms in our expression</span>
<span class="w">    </span><span class="n">r0dotv</span><span class="o">=</span><span class="n">r0⋅v</span>
<span class="w">    </span><span class="n">vsq</span><span class="o">=</span><span class="n">v⋅v</span>
<span class="w">    </span><span class="n">r0sq</span><span class="o">=</span><span class="n">r0⋅r0</span>
<span class="w">    </span><span class="n">discriminant</span><span class="o">=</span><span class="n">r0dotv</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="n">r0sq</span><span class="p">)</span><span class="o">*</span><span class="n">vsq</span>
<span class="w">    </span><span class="c">#</span>
<span class="w">    </span><span class="c"># Now lets just go through each case</span>
<span class="w">    </span><span class="c">#</span>
<span class="w">    </span><span class="c"># Case 1: We are inside the Circle</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">r0sq</span><span class="o">&lt;</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discriminant</span><span class="p">)</span><span class="o">-</span><span class="n">r0dotv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vsq</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="c"># Case 1b: We are on the circle</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">r0sq</span><span class="o">==</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">r0dotv</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="c">#moving away</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Inf</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">r0dotv</span><span class="o">/</span><span class="n">vsq</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="c"># Case 2: Outside the circle, but do not hit it</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">discriminant</span><span class="o">&lt;</span><span class="mi">0</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Inf</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="c"># Case 3: Outside, but moving away</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">r0dotv</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Inf</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="c"># Case 4: Outside, and moving towards</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">r0dotv</span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discriminant</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">vsq</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">cw1</span><span class="o">=</span><span class="n">Cwall</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">b1</span><span class="o">=</span><span class="n">Ball</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">il</span><span class="o">=</span><span class="n">impact_location</span><span class="p">(</span><span class="n">cw1</span><span class="p">,</span><span class="n">b1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">il⋅il</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">impact_time</span><span class="p">(</span><span class="n">cw1</span><span class="p">,</span><span class="n">b1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="deciding-which-wall-to-collide-off-of">
<h2>Deciding which wall to collide off of<a class="headerlink" href="#deciding-which-wall-to-collide-off-of" title="Permalink to this heading">#</a></h2>
<p>Now a billiard will generically have multiple walls.  Lets make a function which produces a rectangular billiard:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Recall:  The Billiard class is defined as</span>
<span class="k">struct</span> <span class="kt">Billiard</span>
<span class="w">    </span><span class="n">walls</span><span class="w"> </span><span class="o">::</span><span class="kt">Array</span><span class="p">{</span><span class="kt">Wall</span><span class="p">}</span>
<span class="w">    </span><span class="n">ball</span><span class="w"> </span><span class="o">::</span><span class="kt">Ball</span>
<span class="w">    </span><span class="n">boundingbox</span><span class="w"> </span><span class="c"># x1,y1,x2,y2 = corners of a rectangle</span>
<span class="k">end</span>

<span class="c"># given the dimensions, and the coordinates of the ball, make a Billiard</span>

<span class="k">function</span><span class="w"> </span><span class="n">rectangular_billiard</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">,</span><span class="n">ball_t</span><span class="p">)</span>
<span class="w">    </span><span class="n">Billiard</span><span class="p">([</span><span class="n">Hwall</span><span class="p">(</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">Hwall</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span>
<span class="w">        </span><span class="n">Ball</span><span class="p">(</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">,</span><span class="n">ball_t</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="k">end</span>

<span class="c"># If you don&#39;t give a location/speed for the ball, just put it at the origin</span>

<span class="n">rectangular_billiard</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">)</span><span class="o">=</span><span class="n">rectangular_billiard</span><span class="p">(</span>
<span class="w">    </span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">rectangular_billiard</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span>
<span class="w">    </span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="n">rectangular_billiard</span><span class="p">(</span>
<span class="w">    </span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">billiard1</span><span class="o">=</span><span class="n">rectangular_billiard</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">billiard1</span><span class="o">.</span><span class="n">walls</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b1</span><span class="o">=</span><span class="n">billiard1</span><span class="o">.</span><span class="n">ball</span>
<span class="n">set_v!</span><span class="p">(</span><span class="n">b1</span><span class="p">,[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">b1</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">b1</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how we get all of the times for the collision of the ball with the walls</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">its</span><span class="o">=</span><span class="p">[</span><span class="n">impact_time</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b1</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">billiard1</span><span class="o">.</span><span class="n">walls</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We now want to extract the smallest time which is greater than the current time</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    argmin_abovetheshold(list,threshold)</span>

<span class="s">finds the location in `list`, which contains the smallest element which is greater than `threshold`.  </span>
<span class="s">Returns `0` if there is no element above `threshold`.  If there is a tie, it returns the one that </span>
<span class="s">occurs first in the list.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">argmin_abovetheshold</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="n">threshold</span><span class="p">)</span>
<span class="w">    </span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="c"># this will store the result</span>
<span class="w">    </span><span class="n">currentmin</span><span class="o">=</span><span class="nb">Inf</span><span class="w"> </span><span class="c"># this will keep track of the smallest element we have found</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="w">  </span><span class="c">#loop over the elements of the list</span>
<span class="w">        </span><span class="n">value</span><span class="o">=</span><span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span><span class="n">threshold</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">value</span><span class="o">&lt;</span><span class="n">currentmin</span><span class="w"> </span><span class="c"># The &amp;&amp; is the logical `and`</span>
<span class="w">            </span><span class="n">location</span><span class="o">=</span><span class="n">i</span>
<span class="w">            </span><span class="n">currentmin</span><span class="o">=</span><span class="n">value</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">location</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">argmin_abovetheshold</span><span class="p">(</span><span class="n">its</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">argmin_abovetheshold</span><span class="p">(</span><span class="n">its</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-velocity-after-collision">
<h2>Setting Velocity after collision<a class="headerlink" href="#setting-velocity-after-collision" title="Permalink to this heading">#</a></h2>
<p>After a collision, the component of the velocity which is normal to the surface should be reversed, while the parallel component should be unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">reflect</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="n">normal</span><span class="p">)</span><span class="o">=</span><span class="n">vec</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">vec⋅normal</span><span class="p">)</span><span class="o">*</span><span class="n">normal</span><span class="o">/</span><span class="p">(</span><span class="n">normal⋅normal</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">reflect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>So we need to extract the normal vector from our walls</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">normal</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Hwall</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">normal</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Vwall</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">normal</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Cwall</span><span class="p">,</span><span class="n">r</span><span class="p">)</span><span class="o">=</span><span class="n">r</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now for a collision, we will first move the ball to the collision point, then calculate/set the velocity.  Here is a function which will calculate the new velocity</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">newvelocity</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Wall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="o">=</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">n</span><span class="o">=</span><span class="n">normal</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="n">v</span><span class="o">=</span><span class="n">get_v</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">set_newvelocity!</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Wall</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span>
<span class="w">    </span><span class="n">v</span><span class="o">=</span><span class="n">newvelocity</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">set_v!</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">time_evolve!</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="o">=</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">v</span><span class="o">=</span><span class="n">get_v</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">t0</span><span class="o">=</span><span class="n">get_t</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">newr</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span>
<span class="w">    </span><span class="n">set_r!</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">newr</span><span class="p">)</span>
<span class="w">    </span><span class="n">set_t!</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span>

<span class="c"># this is the naive implementation of our collide method</span>
<span class="c"># -- it is vulnerable to round-off error though</span>
<span class="k">function</span><span class="w"> </span><span class="n">simplecollide!</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">w</span><span class="o">::</span><span class="kt">Wall</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">start_r</span><span class="o">=</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">time_evolve!</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span>
<span class="k">end</span>

<span class="c"># here is a version which deals with round-off error</span>
<span class="k">function</span><span class="w"> </span><span class="n">collide!</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">,</span><span class="n">w</span><span class="o">::</span><span class="kt">Wall</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">start_r</span><span class="o">=</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">initial_distance</span><span class="o">=</span><span class="n">distance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="n">time_evolve!</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">final_distance</span><span class="o">=</span><span class="n">distance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="c"># should be zero, unless there is roundoff error</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">initial_distance</span><span class="o">*</span><span class="n">final_distance</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="c"># we have overshot the wall</span>
<span class="w">        </span><span class="n">n</span><span class="o">=</span><span class="n">normal</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="w">        </span><span class="n">r</span><span class="o">=</span><span class="n">get_r</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">        </span><span class="n">v</span><span class="o">=</span><span class="n">get_v</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">        </span><span class="n">new_r</span><span class="o">=</span><span class="n">r</span><span class="o">-</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">abs</span><span class="p">(</span><span class="n">final_distance</span><span class="o">/</span><span class="p">(</span><span class="n">n⋅v</span><span class="p">))</span><span class="w"> </span><span class="c"># go backward along trajectory twice the amount that we have overshot</span>
<span class="w">        </span><span class="n">set_r!</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">new_r</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span>
<span class="k">end</span>
<span class="w">    </span>
<span class="k">function</span><span class="w"> </span><span class="n">collision_evolve!</span><span class="p">(</span><span class="n">billiard</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">Billiard</span><span class="p">;</span><span class="n">teps</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
<span class="w">    </span><span class="n">walls</span><span class="o">=</span><span class="n">billiard</span><span class="o">.</span><span class="n">walls</span>
<span class="w">    </span><span class="n">ball</span><span class="o">=</span><span class="n">billiard</span><span class="o">.</span><span class="n">ball</span>
<span class="w">    </span><span class="n">collisiontimes</span><span class="o">=</span><span class="p">[</span><span class="n">impact_time</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">ball</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">walls</span><span class="p">]</span>
<span class="w">    </span><span class="n">next_collision_index</span><span class="o">=</span><span class="n">argmin_abovetheshold</span><span class="p">(</span><span class="n">collisiontimes</span><span class="p">,</span><span class="n">ball</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">collide!</span><span class="p">(</span><span class="n">ball</span><span class="p">,</span><span class="n">walls</span><span class="p">[</span><span class="n">next_collision_index</span><span class="p">],</span><span class="n">collisiontimes</span><span class="p">[</span><span class="n">next_collision_index</span><span class="p">]</span><span class="o">-</span><span class="n">teps</span><span class="p">)</span>
<span class="w">    </span><span class="n">set_newvelocity!</span><span class="p">(</span><span class="n">walls</span><span class="p">[</span><span class="n">next_collision_index</span><span class="p">],</span><span class="n">ball</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">billiard</span>
<span class="k">end</span><span class="w"> </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">billiard1</span><span class="o">=</span><span class="n">rectangular_billiard</span><span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">b1</span><span class="o">=</span><span class="n">billiard1</span><span class="o">.</span><span class="n">ball</span>
<span class="n">set_v!</span><span class="p">(</span><span class="n">b1</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">collision_evolve!</span><span class="p">(</span><span class="n">billiard1</span><span class="p">;</span><span class="n">teps</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">collision_evolve!</span><span class="p">(</span><span class="n">billiard1</span><span class="p">;</span><span class="n">teps</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">collision_evolve!</span><span class="p">(</span><span class="n">billiard1</span><span class="p">;</span><span class="n">teps</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">collision_evolve!</span><span class="p">(</span><span class="n">billiard1</span><span class="p">;</span><span class="n">teps</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="main-loop">
<h2>Main loop<a class="headerlink" href="#main-loop" title="Permalink to this heading">#</a></h2>
<p>Now we can write code which repeatedly has the ball bouncing off of walls until some condition is sattisfied.  That condition could be a certain number of bounces, or a time.  We could also check to see if the ball returns to its starting conditions – in which case we have periodic motion and things will just keep repeating.</p>
<p>Lets make it simple, and just do a fixed number of collisions.  Lets store the date in its own object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">Billiard_Simulation</span>
<span class="w">    </span><span class="n">billiard</span><span class="w"> </span><span class="o">::</span><span class="kt">Billiard</span>
<span class="w">    </span><span class="n">events</span><span class="w"> </span><span class="o">::</span><span class="kt">Array</span><span class="p">{</span><span class="kt">Ball</span><span class="p">}</span>
<span class="k">end</span>

<span class="n">Base</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Billiard_Simulation</span><span class="p">)</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">io</span><span class="o">::</span><span class="kt">IO</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Billiard_Simulation</span><span class="p">)</span><span class="o">=</span><span class="n">print</span><span class="p">(</span><span class="n">io</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;Billiard_Simulation &lt;&lt;n=&quot;</span><span class="o">*</span><span class="n">repr</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="o">*</span>
<span class="w">    </span><span class="s">&quot; t=&quot;</span><span class="o">*</span><span class="n">repr</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">billiard</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="s">&quot;&gt;&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we choose to store the events as an array of <code class="docutils literal notranslate"><span class="pre">Ball</span></code> objects, then we will need to create a way to copy balls:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Ball</span><span class="p">)</span><span class="o">=</span><span class="n">Ball</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">vy</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b1</span><span class="o">=</span><span class="n">Ball</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b2</span><span class="o">=</span><span class="n">copy</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
<span class="n">b3</span><span class="o">=</span><span class="n">b1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b2</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="mf">5.</span>
<span class="n">b1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b3</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="mf">7.</span>
<span class="n">b1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">simulate</span><span class="p">(</span><span class="n">b</span><span class="o">::</span><span class="kt">Billiard</span><span class="p">,</span><span class="n">n</span><span class="o">::</span><span class="kt">Integer</span><span class="p">)</span>
<span class="w">    </span><span class="n">events</span><span class="o">=</span><span class="p">[</span><span class="n">copy</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">ball</span><span class="p">)]</span>
<span class="w">    </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span>
<span class="w">        </span><span class="n">collision_evolve!</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">        </span><span class="n">push!</span><span class="p">(</span><span class="n">events</span><span class="p">,</span><span class="n">copy</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">ball</span><span class="p">))</span>
<span class="w">        </span><span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Billiard_Simulation</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">events</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">rectangular_billiard</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">typeof</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Writing that simulation was very easy.  Now we just need to make some visualizations.  The notation here may seem a bit complicated, but it is much simpler than what you did with the Duffing oscillator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Master function for visualizing</span>
<span class="c"># -- creates new plot object, and then calls visualize!</span>
<span class="k">function</span><span class="w"> </span><span class="n">visualize</span><span class="p">(</span><span class="n">opts</span><span class="o">...</span><span class="p">;</span><span class="n">namedopts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">viz</span><span class="o">=</span><span class="n">plot</span><span class="p">()</span>
<span class="w">    </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="p">,</span><span class="n">opts</span><span class="o">...</span><span class="p">;</span><span class="n">namedopts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">viz</span>
<span class="k">end</span>

<span class="c">#Visualizing a Billiard Simulation</span>
<span class="k">function</span><span class="w"> </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="o">::</span><span class="kt">Plots</span><span class="o">.</span><span class="n">Plot</span><span class="p">,</span><span class="n">s</span><span class="o">::</span><span class="kt">Billiard_Simulation</span><span class="p">;</span>
<span class="w">        </span><span class="n">walloptions</span><span class="o">=</span><span class="p">[],</span><span class="n">balloptions</span><span class="o">=</span><span class="p">[])</span>
<span class="w">    </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">billiard</span><span class="p">;</span><span class="n">walloptions</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">events</span><span class="p">;</span><span class="n">balloptions</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">viz</span>
<span class="k">end</span>


<span class="k">function</span><span class="w"> </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="o">::</span><span class="kt">Plots</span><span class="o">.</span><span class="n">Plot</span><span class="p">,</span><span class="n">b</span><span class="o">::</span><span class="kt">Billiard</span><span class="p">;</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">walls</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">walls</span>
<span class="w">    </span><span class="n">bbox</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">boundingbox</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">walls</span>
<span class="w">        </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">bbox</span><span class="p">;</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">viz</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="o">::</span><span class="kt">Plots</span><span class="o">.</span><span class="n">Plot</span><span class="p">,</span><span class="n">w</span><span class="o">::</span><span class="kt">Hwall</span><span class="p">,</span><span class="n">bbox</span><span class="p">;</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="n">bbox</span>
<span class="w">    </span><span class="n">y</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">y</span>
<span class="w">    </span><span class="n">plot!</span><span class="p">(</span><span class="n">viz</span><span class="p">,[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">];</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="o">::</span><span class="kt">Plots</span><span class="o">.</span><span class="n">Plot</span><span class="p">,</span><span class="n">w</span><span class="o">::</span><span class="kt">Vwall</span><span class="p">,</span><span class="n">bbox</span><span class="p">;</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="n">bbox</span>
<span class="w">    </span><span class="n">x</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">x</span>
<span class="w">    </span><span class="n">plot!</span><span class="p">(</span><span class="n">viz</span><span class="p">,[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">];</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="o">::</span><span class="kt">Plots</span><span class="o">.</span><span class="n">Plot</span><span class="p">,</span><span class="n">w</span><span class="o">::</span><span class="kt">Cwall</span><span class="p">,</span><span class="n">bbox</span><span class="p">;</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">r</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">r</span>
<span class="w">    </span><span class="n">xdata</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">θ</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">θ</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">/</span><span class="mi">100</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">]</span>
<span class="w">    </span><span class="n">ydata</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">θ</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">θ</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">/</span><span class="mi">100</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">]</span>
<span class="w">    </span><span class="n">plot!</span><span class="p">(</span><span class="n">viz</span><span class="p">,</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">;</span><span class="n">aspectratio</span><span class="o">=</span><span class="ss">:equal</span><span class="p">,</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="o">::</span><span class="kt">Plots</span><span class="o">.</span><span class="n">Plot</span><span class="p">,</span><span class="n">trajectory</span><span class="o">::</span><span class="kt">Array</span><span class="p">{</span><span class="kt">Ball</span><span class="p">};</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">xdata</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">trajectory</span><span class="p">]</span>
<span class="w">    </span><span class="n">ydata</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">trajectory</span><span class="p">]</span>
<span class="w">    </span><span class="n">plot!</span><span class="p">(</span><span class="n">viz</span><span class="p">,</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">;</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">rectangular_billiard</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">100</span><span class="p">);</span>
<span class="n">viz</span><span class="o">=</span><span class="n">visualize</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span>
<span class="w">    </span><span class="n">walloptions</span><span class="o">=</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">balloptions</span><span class="o">=</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;x0=(0.25,0.25),v0=(1,-1)&quot;</span><span class="p">,</span><span class="n">linecolor</span><span class="o">=</span><span class="ss">:blue</span><span class="p">));</span>
<span class="n">display</span><span class="p">(</span><span class="n">viz</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">rectangular_billiard</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="o">-</span><span class="mf">0.801</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">100</span><span class="p">);</span>
<span class="n">visualize!</span><span class="p">(</span><span class="n">viz</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span>
<span class="w">    </span><span class="n">walloptions</span><span class="o">=</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">balloptions</span><span class="o">=</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;x0=(0.2,0.25),v0=(1,-0.8)&quot;</span><span class="p">,</span><span class="n">linecolor</span><span class="o">=</span><span class="ss">:red</span><span class="p">));</span>
<span class="n">display</span><span class="p">(</span><span class="n">viz</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="poincare-sections">
<h3>Poincare sections<a class="headerlink" href="#poincare-sections" title="Permalink to this heading">#</a></h3>
<p>When we were looking at the driven non-linear oscillator we defined the <em>Poincare Section</em> to be a plot of phase space at some particular periodic time.  The analogous quantity for Billiards is to plot phase space at some particular <em>event</em>.  The most obvious is every time the ball hits a wall.  Given that the boundary is a line, and the magnitude of the velocity is fixed, phase space is two dimensional (when the ball is constrained to be on the boundary).  A convenient way to plot things is to use polar coordinates, and plot the direction of the velocity vs the direction of the position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">poincare</span><span class="p">(</span><span class="n">s</span><span class="o">::</span><span class="kt">Billiard_Simulation</span><span class="p">;</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="o">=</span><span class="p">[</span><span class="n">atan</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]]</span>
<span class="w">    </span><span class="n">ϕ</span><span class="o">=</span><span class="p">[</span><span class="n">atan</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">vy</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">vx</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]]</span>
<span class="w">    </span><span class="n">scatter</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span><span class="n">ϕ</span><span class="p">;</span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;tan⁻¹(y/x)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;tan⁻¹(vy/vx)&quot;</span><span class="p">,</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">poincare!</span><span class="p">(</span><span class="n">s</span><span class="o">::</span><span class="kt">Billiard_Simulation</span><span class="p">;</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="o">=</span><span class="p">[</span><span class="n">atan</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]]</span>
<span class="w">    </span><span class="n">ϕ</span><span class="o">=</span><span class="p">[</span><span class="n">atan</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">vy</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">vx</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]]</span>
<span class="w">    </span><span class="n">scatter!</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span><span class="n">ϕ</span><span class="p">;</span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;tan⁻¹(y/x)&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;tan⁻¹(vy/vx)&quot;</span><span class="p">,</span><span class="n">opts</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">poincare</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="animation">
<h2>Animation<a class="headerlink" href="#animation" title="Permalink to this heading">#</a></h2>
<p>It is clear that we need to make some sort of animation of our data.  We could use <code class="docutils literal notranslate"><span class="pre">Plots.jl</span></code> or <code class="docutils literal notranslate"><span class="pre">GLMakie</span></code>.  Since we already loaded <code class="docutils literal notranslate"><span class="pre">Plots.jl</span></code>, lets just use it.  (Though to be honest, I prefer the GLMakie animations)</p>
<p>The simplest animation would simply display the trajectories event by event.  A more sophisticated one would generate a time series from the events</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">eventanimate</span><span class="p">(</span><span class="n">s</span><span class="o">::</span><span class="kt">Billiard_Simulation</span><span class="p">;</span><span class="n">traillength</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="w">        </span><span class="c"># print out a message to let the user know things are starting</span>
<span class="w">    </span><span class="nd">@info</span><span class="w"> </span><span class="s">&quot;Animating Billiard&quot;</span>
<span class="w">    </span><span class="c"># Make a progress bar</span>
<span class="w">    </span><span class="n">billiard</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">billiard</span>
<span class="w">    </span><span class="n">events</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">events</span>
<span class="w">    </span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">events</span><span class="p">]</span>
<span class="w">    </span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">events</span><span class="p">]</span>
<span class="w">    </span><span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">t</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">events</span><span class="p">]</span>
<span class="w">    </span><span class="n">progress_meter</span><span class="o">=</span><span class="n">Progress</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">times</span><span class="p">),</span><span class="n">desc</span><span class="o">=</span><span class="s">&quot;Generating frames: &quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">anim</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nd">@animate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<span class="w">        </span><span class="n">update!</span><span class="p">(</span><span class="n">progress_meter</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<span class="w">        </span><span class="c"># Generate path</span>
<span class="w">        </span><span class="n">x_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="n">y_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="n">plt</span><span class="o">=</span><span class="n">visualize</span><span class="p">(</span><span class="n">billiard</span><span class="p">)</span>
<span class="w">        </span><span class="n">Plots</span><span class="o">.</span><span class="n">plot!</span><span class="p">(</span><span class="n">x_path</span><span class="p">,</span><span class="w"> </span><span class="n">y_path</span><span class="p">,</span><span class="w"> </span><span class="n">linecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span>
<span class="w">            </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>


<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="c"># Generate chem-trails</span>
<span class="w">            </span><span class="n">x_trail</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">traillength</span><span class="p">)</span><span class="o">:</span><span class="n">i</span><span class="p">])</span>
<span class="w">            </span><span class="n">y_trail</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">traillength</span><span class="p">)</span><span class="o">:</span><span class="n">i</span><span class="p">])</span>
<span class="w">            </span><span class="n">n</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">x_trail</span><span class="p">)</span>
<span class="w">            </span><span class="n">widths</span><span class="w"> </span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">            </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>

<span class="w">            </span><span class="n">Plots</span><span class="o">.</span><span class="n">plot!</span><span class="p">(</span><span class="n">x_trail</span><span class="p">,</span><span class="n">y_trail</span><span class="p">,</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="n">widths</span><span class="p">,</span>
<span class="w">                </span><span class="n">seriesalpha</span><span class="w"> </span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span>
<span class="w">        </span><span class="n">Plots</span><span class="o">.</span><span class="n">scatter!</span><span class="p">(</span>
<span class="w">            </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<span class="w">            </span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
<span class="w">            </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span>
<span class="w">            </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">            </span><span class="n">markerstrokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="n">markerstrokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:orange</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span>
<span class="w">        </span><span class="n">Plots</span><span class="o">.</span><span class="n">annotate!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time=&quot;</span><span class="o">*</span><span class="n">string</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">Plots</span><span class="o">.</span><span class="n">gif</span><span class="p">(</span><span class="n">anim</span><span class="p">,</span><span class="w"> </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#eventanimate(s1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#eventanimate(s2)</span>
</pre></div>
</div>
</div>
</div>
<p>Those actually look pretty good.  Nonetheless, if we do want to more fine-grain the motion, here is how I would extract a time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">timeseries</span><span class="p">(</span><span class="n">s</span><span class="o">::</span><span class="kt">Billiard_Simulation</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
<span class="w">    </span><span class="n">events</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">events</span>
<span class="w">    </span><span class="n">t</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span>
<span class="w">    </span><span class="n">x</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
<span class="w">    </span><span class="n">y</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
<span class="w">    </span><span class="n">xlist</span><span class="o">=</span><span class="kt">Array</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="kt">x</span><span class="p">)}(</span><span class="nb">undef</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c"># make an empty array</span>
<span class="w">    </span><span class="n">ylist</span><span class="o">=</span><span class="kt">Array</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="kt">x</span><span class="p">)}(</span><span class="nb">undef</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">times</span><span class="o">=</span><span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}(</span><span class="nb">undef</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="n">start_x</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
<span class="w">        </span><span class="n">start_y</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
<span class="w">        </span><span class="n">start_t</span><span class="o">=</span><span class="n">get_t</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
<span class="w">        </span><span class="n">end_t</span><span class="o">=</span><span class="n">get_t</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
<span class="w">        </span><span class="n">vx</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">vx</span>
<span class="w">        </span><span class="n">vy</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">vy</span>
<span class="w">        </span><span class="n">push!</span><span class="p">(</span><span class="n">xlist</span><span class="p">,</span><span class="n">start_x</span><span class="p">)</span>
<span class="w">        </span><span class="n">push!</span><span class="p">(</span><span class="n">ylist</span><span class="p">,</span><span class="n">start_y</span><span class="p">)</span>
<span class="w">        </span><span class="n">push!</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">start_t</span><span class="p">)</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">t</span><span class="o">&lt;</span><span class="n">end_t</span>
<span class="w">            </span><span class="n">x</span><span class="o">=</span><span class="n">start_x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">start_t</span><span class="p">)</span><span class="o">*</span><span class="n">vx</span>
<span class="w">            </span><span class="n">y</span><span class="o">=</span><span class="n">start_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">start_t</span><span class="p">)</span><span class="o">*</span><span class="n">vy</span>
<span class="w">            </span><span class="n">push!</span><span class="p">(</span><span class="n">xlist</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="w">            </span><span class="n">push!</span><span class="p">(</span><span class="n">ylist</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="w">            </span><span class="n">push!</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">            </span><span class="n">t</span><span class="o">+=</span><span class="n">dt</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span><span class="w">    </span>
<span class="w">    </span><span class="p">(</span><span class="n">billiard</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">billiard</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">xlist</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">ylist</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Since it takes some time to generate the frames we want to show</span>
<span class="c">#  a progress bar.  This is good practice for any slow code.</span>
<span class="k">using</span><span class="w"> </span><span class="n">ProgressMeter</span>

<span class="s">&quot;&quot;&quot;</span>
<span class="s">    animatebilliard(billiard,x,y,times)</span>

<span class="s">Generates an animation of a billiard.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">animatebilliard</span><span class="p">(</span><span class="n">billiard</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">times</span><span class="p">;</span><span class="n">traillength</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="w">    </span>
<span class="w">    </span><span class="c"># print out a message to let the user know things are starting</span>
<span class="w">    </span><span class="nd">@info</span><span class="w"> </span><span class="s">&quot;Animating Billiard&quot;</span>
<span class="w">    </span><span class="c"># Make a progress bar</span>
<span class="w">    </span><span class="n">progress_meter</span><span class="o">=</span><span class="n">Progress</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">times</span><span class="p">),</span><span class="n">desc</span><span class="o">=</span><span class="s">&quot;Generating frames: &quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Loop to generate the frames</span>
<span class="w">    </span><span class="c"># the `@animate` is a macro defined by Plots.jl</span>
<span class="w">    </span><span class="c"># which takes the plot generated in each loop</span>
<span class="w">    </span><span class="c"># and wraps it into an object that it knows how to </span>
<span class="w">    </span><span class="c"># make a video from</span>
<span class="w">    </span><span class="n">anim</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nd">@animate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
<span class="w">        </span><span class="n">update!</span><span class="p">(</span><span class="n">progress_meter</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<span class="w">        </span><span class="c"># Generate path</span>
<span class="w">        </span><span class="n">x_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="n">y_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="p">]</span>
<span class="w">        </span><span class="n">plt</span><span class="o">=</span><span class="n">visualize</span><span class="p">(</span><span class="n">billiard</span><span class="p">)</span>
<span class="w">        </span><span class="n">Plots</span><span class="o">.</span><span class="n">plot!</span><span class="p">(</span><span class="n">x_path</span><span class="p">,</span><span class="w"> </span><span class="n">y_path</span><span class="p">,</span><span class="w"> </span><span class="n">linecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span>
<span class="w">            </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>


<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="c"># Generate chem-trails</span>
<span class="w">            </span><span class="n">x_trail</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">traillength</span><span class="p">)</span><span class="o">:</span><span class="n">i</span><span class="p">])</span>
<span class="w">            </span><span class="n">y_trail</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">traillength</span><span class="p">)</span><span class="o">:</span><span class="n">i</span><span class="p">])</span>
<span class="w">            </span><span class="n">n</span><span class="o">=</span><span class="n">length</span><span class="p">(</span><span class="n">x_trail</span><span class="p">)</span>
<span class="w">            </span><span class="n">widths</span><span class="w"> </span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">            </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>

<span class="w">            </span><span class="n">Plots</span><span class="o">.</span><span class="n">plot!</span><span class="p">(</span><span class="n">x_trail</span><span class="p">,</span><span class="n">y_trail</span><span class="p">,</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="n">widths</span><span class="p">,</span>
<span class="w">                </span><span class="n">seriesalpha</span><span class="w"> </span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span>
<span class="w">        </span><span class="n">Plots</span><span class="o">.</span><span class="n">scatter!</span><span class="p">(</span>
<span class="w">            </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<span class="w">            </span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
<span class="w">            </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span>
<span class="w">            </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">            </span><span class="n">markerstrokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="n">markerstrokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:orange</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span>
<span class="w">        </span><span class="n">Plots</span><span class="o">.</span><span class="n">annotate!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time=&quot;</span><span class="o">*</span><span class="n">string</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">Plots</span><span class="o">.</span><span class="n">gif</span><span class="p">(</span><span class="n">anim</span><span class="p">,</span><span class="w"> </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span>
<span class="k">end</span><span class="w"> </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ts1</span><span class="o">=</span><span class="n">timeseries</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#animatebilliard(ts1...)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">rectangular_billiard</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="o">-</span><span class="mf">0.801</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">500</span><span class="p">);</span>
<span class="n">ts2</span><span class="o">=</span><span class="n">timeseries</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span>
<span class="c">#animatebilliard(ts2...)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="circular-billiard">
<h2>Circular Billiard<a class="headerlink" href="#circular-billiard" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">circular_billiard</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">,</span><span class="n">ball_t</span><span class="p">)</span>
<span class="w">    </span><span class="n">Billiard</span><span class="p">([</span><span class="n">Cwall</span><span class="p">(</span><span class="n">r</span><span class="p">)],</span>
<span class="w">        </span><span class="n">Ball</span><span class="p">(</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">,</span><span class="n">ball_t</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="o">-</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="p">))</span>
<span class="k">end</span>

<span class="c"># If you don&#39;t give a location/speed for the ball, just put it at the origin</span>

<span class="n">circular_billiard</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">=</span><span class="n">circular_billiard</span><span class="p">(</span>
<span class="w">    </span><span class="n">r</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">circular_billiard</span><span class="p">(</span><span class="n">r</span><span class="p">,</span>
<span class="w">    </span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="n">circular_billiard</span><span class="p">(</span>
<span class="w">    </span><span class="n">r</span><span class="p">,</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">,</span><span class="n">ball_vx</span><span class="p">,</span><span class="n">ball_vy</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b3</span><span class="o">=</span><span class="n">circular_billiard</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">b3</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">visualize</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We see that the trajectories seem to “accumulate” on a ring.  This is referred to as a “caustic”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">poincare</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#eventanimate(s3)</span>
</pre></div>
</div>
</div>
</div>
<section id="sinai-billiards">
<h3>Sinai Billiards<a class="headerlink" href="#sinai-billiards" title="Permalink to this heading">#</a></h3>
<p>If we put a circular wall inside a rectangular Billiard, we get more interesting behavior</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b_sinai</span><span class="o">=</span><span class="w"> </span><span class="n">Billiard</span><span class="p">([</span><span class="n">Hwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Hwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">Cwall</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span>
<span class="w">    </span><span class="n">Ball</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">),[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">b_sinai</span><span class="p">,</span><span class="n">aspectratio</span><span class="o">=</span><span class="ss">:equal</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now if we watch the ball motion, it appears chaotic</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">b_sinai</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="c">#eventanimate(ss)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">poincare</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets fill that in a bit more</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">longss</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">b_sinai</span><span class="p">,</span><span class="mi">5000</span><span class="p">)</span>
<span class="n">poincare</span><span class="p">(</span><span class="n">longss</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that other initial conditions are regular</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">b_sinai2</span><span class="o">=</span><span class="w"> </span><span class="n">Billiard</span><span class="p">([</span><span class="n">Hwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Hwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">Cwall</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span>
<span class="w">    </span><span class="n">Ball</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ss2</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">b_sinai2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">visualize</span><span class="p">(</span><span class="n">ss2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sensitive-dependence-on-initial-condidtions">
<h3>Sensitive dependence on initial condidtions<a class="headerlink" href="#sensitive-dependence-on-initial-condidtions" title="Permalink to this heading">#</a></h3>
<p>As before, to explore chaos, we want to look at the Jacobian</p>
<div class="amsmath math notranslate nohighlight" id="equation-ac60b1eb-1435-46e1-8ab6-1981762a4c7c">
<span class="eqno">(94)<a class="headerlink" href="#equation-ac60b1eb-1435-46e1-8ab6-1981762a4c7c" title="Permalink to this equation">#</a></span>\[\begin{equation}
J=\left(\begin{array}{cccc}
\frac{\partial x}{\partial x_0}&amp;
\frac{\partial x}{\partial y_0}&amp;
\frac{\partial x}{\partial vx_0}&amp;
\frac{\partial x}{\partial vy_0}\\
\frac{\partial y}{\partial x_0}&amp;
\frac{\partial y}{\partial y_0}&amp;
\frac{\partial y}{\partial vx_0}&amp;
\frac{\partial y}{\partial vy_0}\\
\frac{\partial vx}{\partial x_0}&amp;
\frac{\partial vx}{\partial y_0}&amp;
\frac{\partial vx}{\partial vx_0}&amp;
\frac{\partial vx}{\partial vy_0}\\
\frac{\partial vy}{\partial x_0}&amp;
\frac{\partial vy}{\partial y_0}&amp;
\frac{\partial vy}{\partial vx_0}&amp;
\frac{\partial vy}{\partial vy_0}\\
\end{array}\right),
\end{equation}\]</div>
<p>evaluated at the bounces.</p>
<p>To find these derivatives we will use the <code class="docutils literal notranslate"><span class="pre">ForwardDiff</span></code> package</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">ForwardDiff</span><span class="w"> </span><span class="c"># load package</span>
<span class="n">FD</span><span class="o">=</span><span class="n">ForwardDiff</span><span class="w"> </span><span class="c"># rename package, for easy reference</span>
</pre></div>
</div>
</div>
</div>
<p>We then want to make some helper routines that makes the coordinates in <code class="docutils literal notranslate"><span class="pre">ball</span></code> these dual vectors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">dualxv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">FD</span><span class="o">.</span><span class="n">Dual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">FD</span><span class="o">.</span><span class="n">Partials</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">))),</span>
<span class="w">            </span><span class="n">FD</span><span class="o">.</span><span class="n">Dual</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">FD</span><span class="o">.</span><span class="n">Partials</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">))),</span>
<span class="w">            </span><span class="n">FD</span><span class="o">.</span><span class="n">Dual</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="n">FD</span><span class="o">.</span><span class="n">Partials</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">))),</span>
<span class="w">            </span><span class="n">FD</span><span class="o">.</span><span class="n">Dual</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span><span class="n">FD</span><span class="o">.</span><span class="n">Partials</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)))]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">dualball</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Ball</span><span class="p">(</span><span class="n">dualxv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">)</span><span class="o">...</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">jac</span><span class="p">(</span><span class="n">dball</span><span class="p">)</span>
<span class="w">    </span><span class="n">hcat</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="n">dball</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">partials</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
<span class="w">        </span><span class="n">collect</span><span class="p">(</span><span class="n">dball</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">partials</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
<span class="w">        </span><span class="n">collect</span><span class="p">(</span><span class="n">dball</span><span class="o">.</span><span class="n">vx</span><span class="o">.</span><span class="n">partials</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
<span class="w">        </span><span class="n">collect</span><span class="p">(</span><span class="n">dball</span><span class="o">.</span><span class="n">vy</span><span class="o">.</span><span class="n">partials</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>Here is a simple example</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">xv1</span><span class="o">=</span><span class="n">dualxv</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">3.</span><span class="p">,</span><span class="mf">4.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="o">=</span><span class="n">xv1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y1</span><span class="o">=</span><span class="n">xv1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">test</span><span class="o">=</span><span class="n">x1</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="n">y1</span><span class="o">^</span><span class="mi">2</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">test</span><span class="o">.</span><span class="n">value</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">test</span><span class="o">.</span><span class="n">partials</span>
</pre></div>
</div>
</div>
</div>
<p>That tells us that <span class="math notranslate nohighlight">\(d(x^2+y^2)/dx\)</span> evaluated at <span class="math notranslate nohighlight">\(x,y=(1,2)\)</span> is <span class="math notranslate nohighlight">\(2\)</span>,  and <span class="math notranslate nohighlight">\(d(x^2+y^2)/dx\)</span>, evaluated at the same point is <span class="math notranslate nohighlight">\(4\)</span>.</p>
<p>Here is using the <code class="docutils literal notranslate"><span class="pre">dualball</span></code> construction – on a rectangular billiard</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ball_test1</span><span class="o">=</span><span class="n">dualball</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">billiard_test1</span><span class="o">=</span><span class="n">Billiard</span><span class="p">([</span><span class="n">Hwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Hwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span>
<span class="w">        </span><span class="n">Vwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)],</span><span class="n">ball_test1</span><span class="p">,[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">s_test1</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">billiard_test1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">poslist</span><span class="o">=</span><span class="p">[(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s_test1</span><span class="o">.</span><span class="n">events</span><span class="p">]</span>
<span class="n">plot</span><span class="p">(</span><span class="n">poslist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets see what the Jacobian looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">jaclist</span><span class="o">=</span><span class="p">[</span><span class="n">jac</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s_test1</span><span class="o">.</span><span class="n">events</span><span class="p">]</span>
<span class="n">eiglist</span><span class="o">=</span><span class="p">[</span><span class="n">eigvals</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">jaclist</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>There is always one zero eigenvalue, corresponding to moving in the direction of the velocity vector.  After that we always find that the dynamics are always some sort of reflections – which always end up keeping the distance between nearbye trajectories constant.</p>
<p>Lets now see what it is for the Sinai billiard</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">=</span><span class="w"> </span><span class="n">Billiard</span><span class="p">([</span><span class="n">Hwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Hwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Vwall</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">Cwall</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span>
<span class="w">    </span><span class="n">Ball</span><span class="p">(</span><span class="n">dualxv</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">...</span><span class="p">,</span><span class="mf">0.</span><span class="p">),[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ds</span><span class="o">=</span><span class="n">simulate</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
<span class="n">jaclist</span><span class="o">=</span><span class="p">[</span><span class="n">jac</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ds</span><span class="o">.</span><span class="n">events</span><span class="p">]</span>
<span class="n">eiglist</span><span class="o">=</span><span class="p">[</span><span class="n">eigvals</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">jaclist</span><span class="p">]</span>
<span class="n">scatter</span><span class="p">([</span><span class="n">maximum</span><span class="p">(</span><span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eiglist</span><span class="p">],</span><span class="n">yscale</span><span class="o">=</span><span class="ss">:log10</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;bounce&quot;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;maximum eigenvalue of jacobian&quot;</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
</div>
</div>
<p>Apparently nearebye trajectories diverge exponentially – indicating chaos.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.10"
        },
        kernelOptions: {
            name: "julia-1.10",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.10'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="More%20Duffing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Exploring Chaos with our Duffing Simulator</p>
      </div>
    </a>
    <a class="right-next"
       href="blankLAB%20Interacting%20Hard%20Spheres.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">LAB – Interacting Hard Spheres</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#class-hierarchies-and-abstract-types">Class Hierarchies and abstract types</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#billiard-class">Billiard Class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ball-class">Ball Class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wall-class">Wall Class</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-roundoff">Dealing with Roundoff</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#circular-walls">Circular Walls</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deciding-which-wall-to-collide-off-of">Deciding which wall to collide off of</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-velocity-after-collision">Setting Velocity after collision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-loop">Main loop</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#poincare-sections">Poincare sections</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#animation">Animation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#circular-billiard">Circular Billiard</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sinai-billiards">Sinai Billiards</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitive-dependence-on-initial-condidtions">Sensitive dependence on initial condidtions</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Erich Mueller
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>