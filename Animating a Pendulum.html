

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Interactive Animation of Pendulum &#8212; PHYS 4480-7680 Computational Physics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Animating a Pendulum';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lab – Animating the Duffing Oscillator" href="blankLAB%20Animating%20the%20Duffing%20Oscillator.html" />
    <link rel="prev" title="Followup on Duffing Oscillator" href="Duffing%20Oscillator%20Followup.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="PHYS 4480-7680 Computational Physics - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="PHYS 4480-7680 Computational Physics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Physics 4480 / 7680 / Astronomy 7690
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook%20Workflow.html">Notebook Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logistics.html">Logistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installing Julia</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quadratures -- Period of a Pendulum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Period%20of%20a%20pendulum.html">Period of a Pendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Period%20of%20a%20Pendulum.html">Lab – Period of a Pendulum</a></li>




<li class="toctree-l1"><a class="reference internal" href="Integration%20Followup.html">Integration Follow-up</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Solving Ordinary Differential Equations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Pendulum%20dynamics.html">Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Projectile%20Motion.html">LAB – Projectile Motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="Automatic%20Differentiation.html">Automatic Differentiation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Classical Mechanics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Symplectic%20Integrators.html">Symmetry Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Chaos.html">LAB – Chaos</a></li>
<li class="toctree-l1"><a class="reference internal" href="Duffing%20Oscillator%20Followup.html">Followup on Duffing Oscillator</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Interactive Animation of Pendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="blankLAB%20Animating%20the%20Duffing%20Oscillator.html">Lab – Animating the Duffing Oscillator</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Animating a Pendulum.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Interactive Animation of Pendulum</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asynchronous-computation">Asynchronous Computation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-for-solving-the-differential-equation">Code for Solving the differential equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-a-makie-scene">Generating a Makie Scene</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-trails">Adding trails</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="interactive-animation-of-pendulum">
<h1>Interactive Animation of Pendulum<a class="headerlink" href="#interactive-animation-of-pendulum" title="Permalink to this heading">#</a></h1>
<p>As is clear, I find that visualization can be as important as getting numerical answers:  If you can’t plot your results, then you can’t get any insight.  Earlier we saw one strategy for animating our solution to the differential equation:</p>
<ol class="arabic simple">
<li><p>Generate time series</p></li>
<li><p>Generate animation frames from time series</p></li>
<li><p>Assemble frames into a movie</p></li>
<li><p>Save the movie to disk</p></li>
<li><p>Display the saved movie</p></li>
</ol>
<p>The nice thing about that approach is that you can use the same time series for visualization and other analysis.  It also gives you a movie to share.</p>
<p>There is a second paradigm, where one generates the frames of the video “on the fly.”  You run it until you see something interesting.  You don’t have a permanent record, but it is still useful.</p>
<p>The syntax for making a movie in <code class="docutils literal notranslate"><span class="pre">Plots.jl</span></code> is relatively straightforward.  Here we will use <code class="docutils literal notranslate"><span class="pre">Makie.jl</span></code> to make an interactive animation.  The syntax is a bit trickier.</p>
<p>If you just want working animation code – just scroll to the end of this notebook.  There is a single cell which contains a self-contained animator for the pendulum.</p>
<section id="asynchronous-computation">
<h2>Asynchronous Computation<a class="headerlink" href="#asynchronous-computation" title="Permalink to this heading">#</a></h2>
<p>Another reason for going into this is it introduces an alternate model of computation, <em>asynchronous computation</em>.</p>
<p>So far all of our code has been <em>synchronous</em>, <em>procedural</em>, and <em>linear</em>.  The computer steps line-by-line through a program.  Executing one command after the next.  There can be branching and loops, but one thing leads to the next.</p>
<p>In an asynchronous model, one instead has independent little mini-programs running, which <em>listen</em> for an event.  Whenever an event occurs they do something.  We will use this to make <em>user interfaces</em> – programs which interact with a user.  The interface waits around for human input, and when some occurs it starts some autonomous thread doing something.  While that thread is running it still accepts more input.</p>
<p>These Jupyter notebooks are a good example.</p>
<p>I was hoping to use <code class="docutils literal notranslate"><span class="pre">interact.jl</span></code> to demonstrate this concept, but since it is not working well with the latest Jupyter notebooks, we will instead use <code class="docutils literal notranslate"><span class="pre">GLMakie</span></code>.  This is a <code class="docutils literal notranslate"><span class="pre">OpenGL</span></code> backend for the <code class="docutils literal notranslate"><span class="pre">Makie</span></code> plotting program.  We earlier saw <code class="docutils literal notranslate"><span class="pre">CairoMakie</span></code>, which is a different backend.  <code class="docutils literal notranslate"><span class="pre">OpenGL</span></code> is a toolkit (API) for displaying graphics.</p>
<p>One downside of spending time on this is that the exact syntax is somewhat specialized.  If we learn the commands to use <code class="docutils literal notranslate"><span class="pre">GLMakie</span></code>, those same commands will not work in a <code class="docutils literal notranslate"><span class="pre">Python</span></code> or <code class="docutils literal notranslate"><span class="pre">Javascript</span></code>.  Nonethless the general architecture of all of these interfaces tend to be fairly similar.  Moreover concepts are transferable.</p>
<p>If you want to make interactive interfaces which everyone can access using a web browser, you should look into <code class="docutils literal notranslate"><span class="pre">WGLMakie</span></code>.  You may also want to consider writing such things in <code class="docutils literal notranslate"><span class="pre">Javascript</span></code> – which is a programming language which runs on most web browsers.  <code class="docutils literal notranslate"><span class="pre">Javascript</span></code> is slow, and it is not as fun to program in as Julia.</p>
</section>
<section id="code-for-solving-the-differential-equation">
<h2>Code for Solving the differential equation<a class="headerlink" href="#code-for-solving-the-differential-equation" title="Permalink to this heading">#</a></h2>
<p>Before getting in to using <code class="docutils literal notranslate"><span class="pre">GLMakie</span></code>, we should set up some of the actual computational infrastructure.  We are going to make a program which animates a pendulum – and allows us to interact with that animation.  The actual physics will be really really easy.  The hard part is telling the computer how to display things and how to let us interact with it.</p>
<p>We will use our Runge Kutta time stepper – but we can obviously introduce another one.  We will write the animation code in such a way that we can just plug in the functions that we are using for our integrator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">pendulum_dxdt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="o">=</span><span class="n">x</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">rk4step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">k2</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k1</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">k3</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k2</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">k4</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k3</span><span class="o">*</span><span class="n">deltat</span><span class="p">,</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">+</span><span class="n">k4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">rk4step</span><span class="p">(;</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span><span class="o">=</span><span class="n">rk4step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rk4step (generic function with 2 methods)
</pre></div>
</div>
</div>
</div>
</section>
<section id="generating-a-makie-scene">
<h2>Generating a Makie Scene<a class="headerlink" href="#generating-a-makie-scene" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">GLMakie</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Make an &quot;observable&quot; which will update the figure whenever it is changed</span>
<span class="n">ball</span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="c">#</span>
<span class="c"># Generate Figure</span>
<span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">();</span><span class="w"> </span><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">scatter!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">ball</span><span class="p">;</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">strokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">strokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">,</span>
<span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pendulum&quot;</span>
<span class="n">ax</span><span class="o">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataAspect</span><span class="p">()</span><span class="w"> </span><span class="c"># Set aspect ratio</span>
<span class="n">xlims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">ylims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now move the ball around with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ball</span><span class="p">[]</span><span class="o">=</span><span class="n">Point2f</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2-element Point{2, Float32} with indices SOneTo(2):
 0.5
 0.1
</pre></div>
</div>
</div>
</div>
<p>Lets now disable the zoom feature of Makie</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Makie</span><span class="o">.</span><span class="n">deactivate_interaction!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="ss">:rectanglezoom</span><span class="p">)</span>
<span class="n">xlims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">ylims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets add another observable to be the shaft of the pendulum</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rod</span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">([</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)])</span>
<span class="n">lines!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">rod</span><span class="p">;</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lines{Tuple{Vector{Point{2, Float32}}}}
</pre></div>
</div>
</div>
</div>
<p>We can now define a function which sets the pendulum to a particular angle.  It will be convenient to feed the vector <code class="docutils literal notranslate"><span class="pre">θv=[θ,v]</span></code>, as that is what is used by our stepper/integrator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">θ</span><span class="p">),</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">θ</span><span class="p">))</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">setangle!</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">rod</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)]</span>
<span class="w">    </span><span class="n">ball</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>setangle! (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">setangle!</span><span class="p">([</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2-element Point{2, Float32} with indices SOneTo(2):
  1.0
 -6.123234f-17
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">setangle!</span><span class="p">([</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2-element Point{2, Float32} with indices SOneTo(2):
  0.70710677
 -0.70710677
</pre></div>
</div>
</div>
</div>
<p>At this point it is useful to make an object which stores all of this information</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># We will learn more about this construction soon</span>
<span class="c"># An abstract type is a way to group objects together,</span>
<span class="c"># we can then define functions which act on all objects</span>
<span class="c"># that are in a given group.  I am using it here because</span>
<span class="c"># we are going to iterate on our animation software, and </span>
<span class="c"># I would like to define functions that work on all the different</span>
<span class="c"># varients.  I can give the varients different names,</span>
<span class="c"># but as long as they are all subclasses of the abstract class</span>
<span class="c"># they can use the same methods.</span>
<span class="k">abstract</span><span class="w"> </span><span class="k">type</span> <span class="kt">abstractpendulum</span><span class="w"> </span><span class="k">end</span>

<span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">pendulum_basic</span><span class="w"> </span><span class="o">&lt;:</span><span class="kt">abstractpendulum</span>
<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="c">#Makie figure object</span>
<span class="w">    </span><span class="n">ax</span><span class="w">  </span><span class="c">#Makie axis object</span>
<span class="w">    </span><span class="n">ball</span><span class="w"> </span><span class="c">#Observable corresponding to ball</span>
<span class="w">    </span><span class="n">rod</span><span class="w"> </span><span class="c">#Observable corresponding to rod</span>
<span class="w">    </span><span class="n">θv</span><span class="w"> </span><span class="c">#vector [θ,v]</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="c"># current time</span>
<span class="w">    </span><span class="n">dt</span><span class="w"> </span><span class="c"># time step</span>
<span class="w">    </span><span class="c">#</span>
<span class="w">    </span><span class="c"># The following two things we haven&#39;t used yet -- but we will need them for the animation</span>
<span class="w">    </span><span class="n">step</span><span class="w">  </span><span class="c">#the stepper for our differential equation solver -- same syntax as rk4step</span>
<span class="w">    </span><span class="n">dxdt</span><span class="w">  </span><span class="c">#the derivitive rule -- same systax as pendulum_dxdt</span>
<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="c">#how long to wait between displaying frames</span>
<span class="k">end</span>

<span class="c"># Constructor</span>
<span class="c"># This is the function that you call to create one of these objects</span>
<span class="k">function</span><span class="w"> </span><span class="n">pendulum_basic</span><span class="p">(;</span><span class="n">θv</span><span class="o">=</span><span class="p">[</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">t</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">rk4step</span><span class="p">,</span><span class="n">dxdt</span><span class="o">=</span><span class="n">pendulum_dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Extract positions of pendulum</span>
<span class="w">    </span><span class="n">θ</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Make observables</span>
<span class="w">    </span><span class="n">ball</span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="w">    </span><span class="n">rod</span><span class="o">=</span><span class="n">Observable</span><span class="p">([</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)])</span>
<span class="w">    </span><span class="c"># Make scene</span>
<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">();</span><span class="w"> </span><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">scatter!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">ball</span><span class="p">;</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">strokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">strokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">,</span>
<span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">    </span><span class="n">lines!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">rod</span><span class="p">;</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pendulum&quot;</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataAspect</span><span class="p">()</span><span class="w"> </span><span class="c"># Set aspect ratio</span>
<span class="w">    </span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Set up interactive</span>
<span class="w">    </span><span class="n">Makie</span><span class="o">.</span><span class="n">deactivate_interaction!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="ss">:rectanglezoom</span><span class="p">)</span>
<span class="w">    </span><span class="c">#Create object</span>
<span class="w">    </span><span class="n">pendulum_basic</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">ball</span><span class="p">,</span><span class="n">rod</span><span class="p">,</span><span class="n">θv</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">θv</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">rod</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)]</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">ball</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>setangle! (generic function with 2 methods)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">p2</span><span class="o">=</span><span class="n">pendulum_basic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pendulum_basic(Scene (600px, 450px):
  0 Plots
  1 Child Scene:
    └ Scene (600px, 450px), Axis (2 plots), Observable(Float32[0.70710677, -0.70710677]), Observable(Point{2, Float32}[[0.0, 0.0], [0.70710677, -0.70710677]]), [0.7853981633974483, 0.0], 0.0, 0.01, rk4step, pendulum_dxdt, 0.001)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">setangle!</span><span class="p">(</span><span class="n">p2</span><span class="p">,[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pendulum_basic(Scene (600px, 450px):
  0 Plots
  1 Child Scene:
    └ Scene (600px, 450px), Axis (2 plots), Observable(Float32[0.099833414, -0.9950042]), Observable(Point{2, Float32}[[0.0, 0.0], [0.099833414, -0.9950042]]), [0.1, 0.3], 0.0, 0.01, rk4step, pendulum_dxdt, 0.001)
</pre></div>
</div>
</div>
</div>
<p>We can now make a function which steps the pendulum one timestep</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">step!</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">)</span>
<span class="w">    </span><span class="n">θv</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">θv</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dxdt</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
<span class="w">    </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="o">+=</span><span class="n">p</span><span class="o">.</span><span class="n">dt</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>step! (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">1000</span>
<span class="w">    </span><span class="n">step!</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>One fun thing would be to be able to drag around the pendulum.  <code class="docutils literal notranslate"><span class="pre">GLMakie</span></code> has the ability to watch for mouse clicks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">spoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_point</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">)</span>

<span class="k">function</span><span class="w"> </span><span class="n">θvcoords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atan</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">π</span><span class="o">/</span><span class="mi">2</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">θ</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">on</span><span class="p">(</span><span class="n">spoint</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">z</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span>
<span class="w">    </span><span class="n">θv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">θvcoords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ObserverFunction defined at In[15]:9 operating on Observable(Float32[0.0, 0.0])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">1000</span>
<span class="w">    </span><span class="n">step!</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>That is fun.  Lets update our pendulum constructor so that the object will automatically have that ability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">pendulum_basic</span><span class="p">(;</span><span class="n">θv</span><span class="o">=</span><span class="p">[</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">rk4step</span><span class="p">,</span><span class="n">dxdt</span><span class="o">=</span><span class="n">pendulum_dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Extract positions of pendulum</span>
<span class="w">    </span><span class="n">θ</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Make observables</span>
<span class="w">    </span><span class="n">ball</span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="w">    </span><span class="n">rod</span><span class="o">=</span><span class="n">Observable</span><span class="p">([</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)])</span>
<span class="w">    </span><span class="c"># Make scene</span>
<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">();</span><span class="w"> </span><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">scatter!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">ball</span><span class="p">;</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">strokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">strokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">,</span>
<span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">    </span><span class="n">lines!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">rod</span><span class="p">;</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pendulum&quot;</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataAspect</span><span class="p">()</span><span class="w"> </span><span class="c"># Set aspect ratio</span>
<span class="w">    </span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="c">#Create object</span>
<span class="w">    </span><span class="n">p</span><span class="o">=</span><span class="n">pendulum_basic</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">ball</span><span class="p">,</span><span class="n">rod</span><span class="p">,</span><span class="n">θv</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="c">#</span>
<span class="w">    </span><span class="c"># New lines</span>
<span class="w">    </span><span class="c"># Set up interactive</span>
<span class="w">    </span><span class="c">#</span>
<span class="w">    </span><span class="n">Makie</span><span class="o">.</span><span class="n">deactivate_interaction!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="ss">:rectanglezoom</span><span class="p">)</span>
<span class="w">    </span><span class="n">spoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_point</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">)</span>
<span class="w">    </span><span class="n">on</span><span class="p">(</span><span class="n">spoint</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">z</span>
<span class="w">        </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span>
<span class="w">        </span><span class="n">θv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">θvcoords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">        </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pendulum_basic
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span><span class="o">=</span><span class="n">pendulum_basic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pendulum_basic(Scene (600px, 450px):
  0 Plots
  1 Child Scene:
    └ Scene (600px, 450px), Axis (3 plots), Observable(Float32[0.70710677, -0.70710677]), Observable(Point{2, Float32}[[0.0, 0.0], [0.70710677, -0.70710677]]), [0.7853981633974483, 0.0], 0, 0.01, rk4step, pendulum_dxdt, 0.001)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">1000</span>
<span class="w">    </span><span class="n">step!</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>Now what we need to do is make a “run” button.  That toggles the simulation on and off</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">isrunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span>
<span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;Stop&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Run&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">isrunning</span><span class="p">)</span>
<span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Button</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">fig</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">tellwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="n">on</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">clicks</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">clicks</span><span class="p">;</span><span class="w"> </span><span class="n">isrunning</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isrunning</span><span class="p">[];</span><span class="w"> </span><span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ObserverFunction defined at In[20]:4 operating on Observable{Any}(0)
</pre></div>
</div>
</div>
</div>
<p>Now lets hook into that observable</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">isrunning_notifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Condition</span><span class="p">()</span>
<span class="n">on</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">notify</span><span class="p">(</span><span class="n">isrunning_notifier</span><span class="p">),</span><span class="w"> </span><span class="n">isrunning</span><span class="p">)</span>
<span class="n">errormonitor</span><span class="p">(</span><span class="nd">@async</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">isrunning</span><span class="p">[]</span>
<span class="w">        </span><span class="n">isopen</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="c"># ensures computations stop if closed window</span>
<span class="w">        </span><span class="n">step!</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span><span class="w"> </span><span class="c"># or `yield()` instead</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">isrunning_notifier</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task (runnable) @0x000000014e11c970
</pre></div>
</div>
</div>
</div>
<p>Now lets add that ability to the object – and also copy all of the definitions to one place.  This one cell is self-contained, you should be able to run it without any of the rest of the notebook.  We need to add new attributes to the object, so we need to rename it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">GLMakie</span>

<span class="k">function</span><span class="w"> </span><span class="n">pendulum_dxdt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="o">=</span><span class="n">x</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">rk4step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">k2</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k1</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">k3</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k2</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">k4</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k3</span><span class="o">*</span><span class="n">deltat</span><span class="p">,</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">+</span><span class="n">k4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">rk4step</span><span class="p">(;</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span><span class="o">=</span><span class="n">rk4step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span>

<span class="k">function</span><span class="w"> </span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">θ</span><span class="p">),</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">θ</span><span class="p">))</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">θvcoords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atan</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">π</span><span class="o">/</span><span class="mi">2</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">θ</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">setangle!</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">rod</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)]</span>
<span class="w">    </span><span class="n">ball</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">abstract</span><span class="w"> </span><span class="k">type</span> <span class="kt">abstractpendulum</span><span class="w"> </span><span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">step!</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">)</span>
<span class="w">    </span><span class="n">θv</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">θv</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dxdt</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
<span class="w">    </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="o">+=</span><span class="n">p</span><span class="o">.</span><span class="n">dt</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">θv</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">rod</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)]</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">ball</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span>
<span class="k">end</span>

<span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">pendulum</span><span class="w"> </span><span class="o">&lt;:</span><span class="kt">abstractpendulum</span>
<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="c">#Makie figure object</span>
<span class="w">    </span><span class="n">ax</span><span class="w">  </span><span class="c">#Makie axis object</span>
<span class="w">    </span><span class="n">ball</span><span class="w"> </span><span class="c">#Observable corresponding to ball</span>
<span class="w">    </span><span class="n">rod</span><span class="w"> </span><span class="c">#Observable corresponding to rod</span>
<span class="w">    </span><span class="n">θv</span><span class="w"> </span><span class="c">#vector [θ,v]</span>
<span class="w">    </span><span class="n">t</span>
<span class="w">    </span><span class="n">dt</span>
<span class="w">    </span><span class="n">step</span><span class="w">  </span><span class="c">#the stepper for our differential equation solver -- same syntax as rk4step</span>
<span class="w">    </span><span class="n">dxdt</span><span class="w">  </span><span class="c">#the derivitive rule -- same systax as pendulum_dxdt</span>
<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="c">#how long to wait between displaying frames</span>
<span class="w">    </span><span class="c">#</span>
<span class="w">    </span><span class="c"># New lines</span>
<span class="w">    </span><span class="n">run</span><span class="w"> </span><span class="c">#button</span>
<span class="w">    </span><span class="n">isrunning</span><span class="w"> </span><span class="c">#is the simulation running?</span>
<span class="k">end</span>

<span class="c"># constructor</span>
<span class="k">function</span><span class="w"> </span><span class="n">pendulum</span><span class="p">(;</span><span class="n">θv</span><span class="o">=</span><span class="p">[</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">t</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">rk4step</span><span class="p">,</span><span class="n">dxdt</span><span class="o">=</span><span class="n">pendulum_dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Extract positions of pendulum</span>
<span class="w">    </span><span class="n">θ</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Make observables</span>
<span class="w">    </span><span class="n">ball</span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="w">    </span><span class="n">rod</span><span class="o">=</span><span class="n">Observable</span><span class="p">([</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)])</span>
<span class="w">    </span><span class="c"># Make scene</span>
<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">();</span><span class="w"> </span><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">scatter!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">ball</span><span class="p">;</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">strokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">strokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">,</span>
<span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">    </span><span class="n">lines!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">rod</span><span class="p">;</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pendulum&quot;</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataAspect</span><span class="p">()</span><span class="w"> </span><span class="c"># Set aspect ratio</span>
<span class="w">    </span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="c"># run button</span>
<span class="w">    </span><span class="n">isrunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;Stop&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Run&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">isrunning</span><span class="p">)</span>
<span class="w">    </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Button</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">tellwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="n">on</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">clicks</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">clicks</span><span class="p">;</span><span class="w"> </span><span class="n">isrunning</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isrunning</span><span class="p">[];</span><span class="w"> </span><span class="k">end</span>
<span class="w">    </span><span class="c">#Create object</span>
<span class="w">    </span><span class="n">p</span><span class="o">=</span><span class="n">pendulum</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">ball</span><span class="p">,</span><span class="n">rod</span><span class="p">,</span><span class="n">θv</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="p">,</span><span class="n">run</span><span class="p">,</span><span class="n">isrunning</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Set up interactive</span>
<span class="w">    </span><span class="n">Makie</span><span class="o">.</span><span class="n">deactivate_interaction!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="ss">:rectanglezoom</span><span class="p">)</span>
<span class="w">    </span><span class="n">spoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_point</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">)</span>
<span class="w">    </span><span class="n">on</span><span class="p">(</span><span class="n">spoint</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">z</span>
<span class="w">        </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span>
<span class="w">        </span><span class="n">θv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">θvcoords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">        </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">startsim</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">   </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">startsim</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">)</span>
<span class="w">    </span><span class="n">isrunning_notifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Condition</span><span class="p">()</span>
<span class="w">    </span><span class="n">on</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">notify</span><span class="p">(</span><span class="n">isrunning_notifier</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">isrunning</span><span class="p">)</span>
<span class="w">        </span><span class="n">errormonitor</span><span class="p">(</span><span class="nd">@async</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">true</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">isrunning</span><span class="p">[]</span>
<span class="w">            </span><span class="n">isopen</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="c"># ensures computations stop if closed window</span>
<span class="w">            </span><span class="n">step!</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">            </span><span class="n">sleep</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span><span class="w"> </span><span class="c"># or `yield()` instead</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">wait</span><span class="p">(</span><span class="n">isrunning_notifier</span><span class="p">)</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>startsim (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">p3</span><span class="o">=</span><span class="n">pendulum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pendulum(Scene (600px, 450px):
  0 Plots
  2 Child Scenes:
    ├ Scene (600px, 450px)
    └ Scene (600px, 450px), Axis (3 plots), Observable(Float32[0.70710677, -0.70710677]), Observable(Point{2, Float32}[[0.0, 0.0], [0.70710677, -0.70710677]]), [0.7853981633974483, 0.0], 0.0, 0.01, rk4step, pendulum_dxdt, 0.001, Button(), Observable(false))
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-trails">
<h2>Adding trails<a class="headerlink" href="#adding-trails" title="Permalink to this heading">#</a></h2>
<p>Now this is just eye candy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">DataStructures</span><span class="o">:</span><span class="w"> </span><span class="n">CircularBuffer</span>
</pre></div>
</div>
</div>
</div>
<p>A circular buffer is a data type which is like a list or vector – but when add elements on the end it pushes them off the otheer</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span><span class="o">=</span><span class="kt">CircularBuffer</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="mf">1.</span><span class="p">)}(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fill!</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3-element CircularBuffer{Float64}:
 1.0
 1.0
 1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">push!</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3-element CircularBuffer{Float64}:
 1.0
 1.0
 2.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">push!</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="mf">3.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3-element CircularBuffer{Float64}:
 1.0
 2.0
 3.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">push!</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="mf">4.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3-element CircularBuffer{Float64}:
 2.0
 3.0
 4.0
</pre></div>
</div>
</div>
</div>
<p>Make a circular buffer which will store the past locations of the pendulum bob.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">300</span>
<span class="n">traj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">CircularBuffer</span><span class="p">{</span><span class="kt">Point2f</span><span class="p">}(</span><span class="n">tail</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">θv</span><span class="p">)</span>
<span class="n">fill!</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>
<span class="n">traj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="n">traj</span><span class="p">);</span><span class="w"> </span><span class="c"># make it an &quot;Observable&quot; -- meaning GLMakie will update the graph if it is changed</span>
</pre></div>
</div>
</div>
</div>
<p>Make a list of colors which will fade from white to purple.  Then add the trail to the plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">to_color</span><span class="p">(</span><span class="ss">:purple</span><span class="p">)</span>
<span class="n">tailcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">RGBAf</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">tail</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">tail</span><span class="p">]</span>
<span class="n">lines!</span><span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">traj</span><span class="p">;</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tailcol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lines{Tuple{CircularBuffer{Point{2, Float32}}}}
</pre></div>
</div>
</div>
</div>
<p>Now lets upgrade the setangle command so that it also updates the trail</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">θv</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">rod</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)]</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">ball</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">push!</span><span class="p">(</span><span class="n">traj</span><span class="p">[],</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>
<span class="w">    </span><span class="n">notify</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span><span class="w"> </span><span class="c"># needed to tell GLMakie that we updated traj -- push! doesn&#39;t send that signal</span>
<span class="w">    </span><span class="n">p</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>setangle! (generic function with 2 methods)
</pre></div>
</div>
</div>
</div>
<p>Now lets encapsulate that.  Again, I repeated all of the definitions, so that it is self-contained.  Again we need to rename the object, or restart the kernel, because we need to add attributes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">GLMakie</span>
<span class="k">using</span><span class="w"> </span><span class="n">DataStructures</span><span class="o">:</span><span class="w"> </span><span class="n">CircularBuffer</span>

<span class="k">function</span><span class="w"> </span><span class="n">pendulum_dxdt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="o">=</span><span class="n">x</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">rk4step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">k2</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k1</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">k3</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k2</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">k4</span><span class="o">=</span><span class="n">dxdt</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">k3</span><span class="o">*</span><span class="n">deltat</span><span class="p">,</span><span class="n">t</span><span class="o">+</span><span class="n">deltat</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">+</span><span class="n">k4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">deltat</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">rk4step</span><span class="p">(;</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span><span class="o">=</span><span class="n">rk4step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">deltat</span><span class="p">)</span>

<span class="k">function</span><span class="w"> </span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">θ</span><span class="p">),</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">θ</span><span class="p">))</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">θvcoords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">θ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atan</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">π</span><span class="o">/</span><span class="mi">2</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">θ</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">end</span>


<span class="k">abstract</span><span class="w"> </span><span class="k">type</span> <span class="kt">abstractpendulum</span><span class="w"> </span><span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">step!</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">)</span>
<span class="w">    </span><span class="n">θv</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">θv</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dxdt</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
<span class="w">    </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="o">+=</span><span class="n">p</span><span class="o">.</span><span class="n">dt</span>
<span class="k">end</span>

<span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">pendulum_fancy</span><span class="w"> </span><span class="o">&lt;:</span><span class="kt">abstractpendulum</span>
<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="c">#Makie figure object</span>
<span class="w">    </span><span class="n">ax</span><span class="w">  </span><span class="c">#Makie axis object</span>
<span class="w">    </span><span class="n">ball</span><span class="w"> </span><span class="c">#Observable corresponding to ball</span>
<span class="w">    </span><span class="n">rod</span><span class="w"> </span><span class="c">#Observable corresponding to rod</span>
<span class="w">    </span><span class="n">traj</span><span class="w"> </span><span class="c">#Observable corresponding to rod</span>
<span class="w">    </span><span class="n">θv</span><span class="w"> </span><span class="c">#vector [θ,v]</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="c">#current time</span>
<span class="w">    </span><span class="n">dt</span><span class="w"> </span><span class="c">#time step</span>
<span class="w">    </span><span class="n">step</span>
<span class="w">    </span><span class="n">dxdt</span>
<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="c">#how long to wait between displaying frames</span>
<span class="w">    </span><span class="n">run</span><span class="w"> </span><span class="c">#button</span>
<span class="w">    </span><span class="n">isrunning</span><span class="w"> </span><span class="c">#is the simulation running?</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">pendulum_fancy</span><span class="p">(;</span><span class="n">θv</span><span class="o">=</span><span class="p">[</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">t</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">rk4step</span><span class="p">,</span><span class="n">dxdt</span><span class="o">=</span><span class="n">pendulum_dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span><span class="n">tail</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Extract positions of pendulum</span>
<span class="w">    </span><span class="n">θ</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Make observables</span>
<span class="w">    </span><span class="n">ball</span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="w">    </span><span class="n">rod</span><span class="o">=</span><span class="n">Observable</span><span class="p">([</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)])</span>
<span class="w">    </span><span class="c"># Make scene</span>
<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">();</span><span class="w"> </span><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">scatter!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">ball</span><span class="p">;</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">strokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">strokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">,</span>
<span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="w">    </span><span class="n">lines!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">rod</span><span class="p">;</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:purple</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pendulum&quot;</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataAspect</span><span class="p">()</span><span class="w"> </span><span class="c"># Set aspect ratio</span>
<span class="w">    </span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="w"> </span><span class="mf">1.05</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Set up interactive</span>
<span class="w">    </span><span class="n">Makie</span><span class="o">.</span><span class="n">deactivate_interaction!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="ss">:rectanglezoom</span><span class="p">)</span>
<span class="w">    </span><span class="c"># run button</span>
<span class="w">    </span><span class="n">isrunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;Stop&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Run&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">isrunning</span><span class="p">)</span>
<span class="w">    </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Button</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">tellwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="n">on</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">clicks</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">clicks</span><span class="p">;</span><span class="w"> </span><span class="n">isrunning</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isrunning</span><span class="p">[];</span><span class="w"> </span><span class="k">end</span>
<span class="w">    </span><span class="c"># Now lets make the trail</span>
<span class="w">    </span><span class="n">traj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">CircularBuffer</span><span class="p">{</span><span class="kt">Point2f</span><span class="p">}(</span><span class="n">tail</span><span class="p">)</span>
<span class="w">    </span><span class="n">fill!</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>
<span class="w">    </span><span class="n">traj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Observable</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
<span class="w">    </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">to_color</span><span class="p">(</span><span class="ss">:purple</span><span class="p">)</span>
<span class="w">    </span><span class="n">tailcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">RGBAf</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">tail</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">tail</span><span class="p">]</span>
<span class="w">    </span><span class="n">lines!</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">traj</span><span class="p">;</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tailcol</span><span class="p">)</span>
<span class="w">    </span><span class="c">#Create object</span>
<span class="w">    </span><span class="n">p</span><span class="o">=</span><span class="n">pendulum_fancy</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">ball</span><span class="p">,</span><span class="n">rod</span><span class="p">,</span><span class="n">traj</span><span class="p">,</span><span class="n">θv</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="n">dxdt</span><span class="p">,</span><span class="n">delaytime</span><span class="p">,</span><span class="n">run</span><span class="p">,</span><span class="n">isrunning</span><span class="p">)</span>
<span class="w">    </span><span class="n">spoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_point</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">)</span>
<span class="w">    </span><span class="n">on</span><span class="p">(</span><span class="n">spoint</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">z</span>
<span class="w">        </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span>
<span class="w">        </span><span class="n">θv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">θvcoords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">        </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="c">#animation</span>
<span class="w">    </span><span class="n">startsim</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">   </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">setangle!</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">pendulum_fancy</span><span class="p">,</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">θv</span><span class="o">=</span><span class="n">θv</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xycoords</span><span class="p">(</span><span class="n">θv</span><span class="p">)</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">rod</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)]</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">ball</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">push!</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">traj</span><span class="p">[],</span><span class="w"> </span><span class="n">Point2f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>
<span class="w">    </span><span class="n">notify</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">traj</span><span class="p">)</span><span class="w"> </span><span class="c"># needed to tell GLMakie that we updated traj -- push! doesn&#39;t send that signal</span>
<span class="w">    </span><span class="n">p</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">startsim</span><span class="p">(</span><span class="n">p</span><span class="o">::</span><span class="kt">abstractpendulum</span><span class="p">)</span>
<span class="w">    </span><span class="n">isrunning_notifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Condition</span><span class="p">()</span>
<span class="w">    </span><span class="n">on</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">notify</span><span class="p">(</span><span class="n">isrunning_notifier</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">isrunning</span><span class="p">)</span>
<span class="w">        </span><span class="n">errormonitor</span><span class="p">(</span><span class="nd">@async</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">true</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">isrunning</span><span class="p">[]</span>
<span class="w">            </span><span class="n">isopen</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="c"># ensures computations stop if closed window</span>
<span class="w">            </span><span class="n">step!</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">            </span><span class="n">sleep</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span><span class="w"> </span><span class="c"># or `yield()` instead</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">wait</span><span class="p">(</span><span class="n">isrunning_notifier</span><span class="p">)</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>startsim (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">p4</span><span class="o">=</span><span class="n">pendulum_fancy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pendulum_fancy(Scene (600px, 450px):
  0 Plots
  2 Child Scenes:
    ├ Scene (600px, 450px)
    └ Scene (600px, 450px), Axis (4 plots), Observable(Float32[0.70710677, -0.70710677]), Observable(Point{2, Float32}[[0.0, 0.0], [0.70710677, -0.70710677]]), Observable(Point{2, Float32}[[0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677]  …  [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677], [0.70710677, -0.70710677]]), [0.7853981633974483, 0.0], 0.0, 0.01, rk4step, pendulum_dxdt, 0.001, Button(), Observable(false))
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.10"
        },
        kernelOptions: {
            name: "julia-1.10",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.10'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Duffing%20Oscillator%20Followup.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Followup on Duffing Oscillator</p>
      </div>
    </a>
    <a class="right-next"
       href="blankLAB%20Animating%20the%20Duffing%20Oscillator.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab – Animating the Duffing Oscillator</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asynchronous-computation">Asynchronous Computation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-for-solving-the-differential-equation">Code for Solving the differential equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-a-makie-scene">Generating a Makie Scene</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-trails">Adding trails</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Erich Mueller
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>